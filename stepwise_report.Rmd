---
title: "Stepwise Regression Analysis of MPG in the mtcars Dataset"
author: "Data Analysis Report"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(ggplot2)
library(MASS)
library(car)
library(dplyr)
library(tidyr)

# Load and prepare data
data(mtcars)
mtcars$am <- factor(mtcars$am, levels = c(0, 1), labels = c("Automatic", "Manual"))

# Run models
full_model <- lm(mpg ~ ., data = mtcars)
step_model <- stepAIC(full_model, direction = "both", trace = FALSE)
```

## Executive Summary

This report presents the results of a stepwise regression analysis conducted to identify the most influential predictors of Miles Per Gallon (MPG) in the mtcars dataset. The analysis compares a full model (including all predictors) with a stepwise-selected model to determine the optimal combination of variables for predicting MPG.

## Key Findings

### Most Influential Predictors

The stepwise regression identified the following significant predictors of MPG:

```{r}
# Get significant predictors
sig_predictors <- summary(step_model)$coefficients
sig_predictors <- sig_predictors[sig_predictors[,4] < 0.05,]
print(sig_predictors)
```

### Model Performance Comparison

```{r}
# Create comparison table
model_comparison <- data.frame(
    Model = c("Full Model", "Stepwise Model"),
    AIC = c(AIC(full_model), AIC(step_model)),
    BIC = c(BIC(full_model), BIC(step_model)),
    R_squared = c(summary(full_model)$r.squared, summary(step_model)$r.squared),
    Adj_R_squared = c(summary(full_model)$adj.r.squared, summary(step_model)$adj.r.squared)
)

knitr::kable(model_comparison, digits = 3, caption = "Model Performance Metrics")
```

### Best Performing Model

The stepwise model outperforms the full model in several key aspects:

1. **Model Complexity**: Reduced from `r length(coef(full_model))` to `r length(coef(step_model))` predictors
2. **Model Fit**: 
   - R-squared: `r round(summary(step_model)$r.squared, 3)`
   - Adjusted R-squared: `r round(summary(step_model)$adj.r.squared, 3)`
3. **Information Criteria**:
   - AIC: `r round(AIC(step_model), 2)`
   - BIC: `r round(BIC(step_model), 2)`

### Model Formula

The final stepwise model is:

```{r}
print(formula(step_model))
```

## Statistical Significance

```{r}
# Create coefficient plot
coef_df <- data.frame(
    Variable = names(coef(step_model)),
    Coefficient = coef(step_model),
    P_value = summary(step_model)$coefficients[,4]
)

ggplot(coef_df, aes(x = reorder(Variable, abs(Coefficient)), y = Coefficient)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    labs(title = "Coefficient Magnitudes",
         x = "Variables",
         y = "Coefficient Value")
```

## Model Diagnostics

### Residual Analysis

```{r}
par(mfrow = c(2, 2))
plot(step_model, main = "Stepwise Model Residuals")
```

### Multicollinearity Check

```{r}
vif_values <- vif(step_model)
knitr::kable(data.frame(
    Variable = names(vif_values),
    VIF = vif_values
), digits = 2, caption = "Variance Inflation Factors")
```

## Conclusion

The stepwise regression analysis successfully identified the most important predictors of MPG while maintaining model parsimony. The selected model provides a good balance between predictive power and model complexity, as evidenced by the improved AIC and BIC values compared to the full model.

The analysis reveals that MPG is most strongly influenced by a combination of engine characteristics (weight, horsepower, and transmission type) and vehicle design features. The stepwise model provides a more efficient and interpretable solution than the full model, with comparable predictive power but reduced complexity. 